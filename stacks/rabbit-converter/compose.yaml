# docker-compose.yml for Rabbit Fighters Admin Converter
services:
  rabbit-converter:
    image: nginx:alpine
    container_name: rabbit-converter
    environment:
      - TZ=America/Chicago
    volumes:
      - /home/blehnen/docker/appdata/rabbit-converter:/usr/share/nginx/html:ro
      - /home/blehnen/docker/appdata/rabbit-converter/nginx.conf:/etc/nginx/nginx.conf:ro
      - /home/blehnen/docker/appdata/rabbit-converter/auth/.htpasswd:/etc/nginx/.htpasswd:ro
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    labels:
      - traefik.enable=true
      - traefik.http.routers.rabbit-converter.rule=Host(`rabbitadmin.lab1830.com`)
      - traefik.http.routers.rabbit-converter.entrypoints=websecure
      - traefik.http.routers.rabbit-converter.tls=true
      - traefik.http.routers.rabbit-converter.tls.certresolver=letsencrypt
      - traefik.http.services.rabbit-converter.loadbalancer.server.port=80
      - com.centurylinklabs.watchtower.enable=true
      
      # Basic Auth protection
      - traefik.http.middlewares.rabbit-auth.basicauth.users=admin:$$apr1$$x7vDnlJr$$27FKWv4/0CmC8FUaB2xLj0
      - traefik.http.middlewares.rabbit-headers.headers.frameDeny=true
      - traefik.http.middlewares.rabbit-headers.headers.contentTypeNosniff=true
      - traefik.http.routers.rabbit-converter.middlewares=rabbit-auth,rabbit-headers
    networks:
      - web

networks:
  web:
    external: true